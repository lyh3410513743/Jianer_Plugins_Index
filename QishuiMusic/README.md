## 汽水音乐解析插件

汽水音乐（抖音音乐）解析插件，支持自动解析音乐链接、下载音频、歌词显示和群聊白名单管理。

### 功能特性

- 🔗 **自动解析**：自动识别汽水音乐分享链接并解析
- 🎵 **音频下载**：下载高质量音乐文件并转换为WAV格式
- 📝 **歌词显示**：自动获取并清洗歌词，以合并转发形式发送
- ⚙️ **白名单管理**：支持群聊白名单控制解析行为
- 🎯 **权限控制**：管理员可控制白名单状态
- 📱 **多种格式支持**：支持FLAC到WAV的自动转换
- 🔄 **异步处理**：使用异步请求提高响应速度

### 安装要求

#### FFmpeg安装
- **Windows**: 从 [FFmpeg官网](https://ffmpeg.org/) 下载并添加到系统PATH
- **Linux**: `sudo apt install ffmpeg`
- **macOS**: `brew install ffmpeg`

### 配置说明
插件会自动创建和管理白名单文件 `qishui_music_whitelist.txt`，每行一个群号。

### 使用方法

#### 基本功能
在群聊中发送任何汽水音乐分享链接，插件会自动：
1. 解析音乐信息
2. 发送音频直链
3. 下载并发送WAV格式音频
4. 显示歌词（如有）

#### 管理命令
| 命令 | 权限 | 功能说明 |
|------|------|----------|
| `/{reminder}汽水音乐解析帮助` | 所有用户 | 显示插件帮助信息 |
| `/{reminder}本群音乐解析加白` | 管理员/主人 | 将当前群加入白名单（停止解析） |
| `/{reminder}本群音乐解析删白` | 管理员/主人 | 将当前群移出白名单（恢复解析） |

**注意**：将 `{reminder}` 替换为你在配置中设置的命令前缀（默认为 `/`）。

#### 白名单功能
- **在白名单中的群聊**：发送汽水音乐链接时，机器人会回复"本群为汽水音乐解析白名群"，不会进行解析
- **不在白名单的群聊**：正常解析音乐链接

### API说明

插件使用第三方API进行解析：
- API地址：`https://api.bugpk.com/api/qsmusic`
- 请求方式：GET
- 参数：`url={汽水音乐链接}`

### 注意事项

1. **音频文件大小限制**：超过50MB的音频文件不会发送
2. **临时文件清理**：处理完成后会自动清理临时文件
3. **网络超时设置**：请求超时时间为10秒，最多重试3次
4. **格式转换**：FLAC文件会自动转换为WAV格式（44100Hz, 16-bit PCM）
5. **歌词显示限制**：歌词过长时只显示前1500个字符

### 日志信息
插件会在控制台输出以下日志：
- `[QishuiMusic] 音频转换成功/失败`
- `[QishuiMusic] 已发送 WAV 文件`
- `[QishuiMusic] 清理文件时出错`
